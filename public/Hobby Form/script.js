var requiredFields = [
  "name", "email", "unique", "pset", "fplayer", "comb", "money", "lplay"
]
var myPoker = {
  "owner": "Edmon Nazaryan",
  "project": "Hobby",
  "name": "",
  "email": "",
  "unique": "",
  "pset": "",
  "fplayer": "",
  "comb": "",
  "money": "",
  "lplay": "",
  "holdem": "",
  "omaha": "",
  "chips": "",
  "sblind": "",
  "bblind": ""
}

function handleNameChange() {
  myPoker.name = document.getElementById("name").value;
}

function handleEmailChange() {
  myPoker.email = document.getElementById("email").value;
}
function handleUniqueChange() {
  myPoker.unique = document.getElementById("unique")
    .value;
}

function handlePsetChange() {
  myPoker.pset = document.getElementById("pset").value;
}

function handleFplayerChange() {
  myPoker.fplayer = document.getElementById("fplayer").value;
}
function handleCombChange() {
  myPoker.comb = document.getElementById("comb").value;
}

function handleMoneyChange() {
  myPoker.money = document.getElementById("money").value;
}

function handleLplayChange() {
  myPoker.lplay = document.getElementById("lplay").value;
}

function handleHoldemChange() {
  myPoker.sblind=event.target.value;
}

function handleOmahaChange() {
  myPoker.bblind=event.target.value;
}

function handleChipsChange() {
  myPoker.chips = document.getElementById("chips").value;
}

function handleSblindChange() {
  myPoker.sblind=event.target.value;
}

function handleBblindChange() {
  myPoker.bblind=event.target.value;
}

function validateFormData() {
  var isFormValid = true;
  var keys = Object.keys(myPoker);
  keys.forEach(key => {
    if (requiredFields.indexOf(key) > -1 && myPoker[key] == "") {
      console.log(key, " is a required field, please add a value")
      if (document.getElementById(key)) {
        document.getElementById(key).style.backgroundColor = "yellow";
        isFormValid = false;
      }
    }
  })
  return isFormValid;
}


function SaveTheData(e) {
  e.preventDefault();
  console.log(myPoker);
  $.ajax({
    type: 'POST',
    url: "https://cse120-2021-api-ed.herokuapp.com/data",
    data: myPoker,
    cache: false,
    dataType: 'json',
    success: function (data) {
      console.log("success");
    },
    error: function (xhr) {
      console.error("Error in post", xhr);
    },
    complete: function () {
      console.log("Complete");
    }
  });
}
function loadExistingData() {
  $.ajax({
    type: "GET",
    url: "https://cse120-2021-api-ed.herokuapp.com/data",
    dataType: "json",
    success: function (data) {
      console.log("success", data);
      displayData(data.data);
    },
    error: function (data) {
      console.log("Error")
    }
  });
}

function displayData(data) {
  document.getElementById("dataContainer").innerHTML = "";
  data.forEach(elem => {
    var item = document.createElement("div");
    item.id = "div" + elem["_id"];
    item.className = "item";
    if (Object.keys(elem).length == 1) {
      var span = document.createElement("span");
      span.innerHTML = "<i>Empty Element with autogenerated ID: </i>" + elem["_id"];
      item.appendChild(span);
    }
    Object.keys(elem).forEach(key => {
      if (key != "_id") {
        var span = document.createElement("span");

        var b = document.createElement("b");
        b.innerHTML = key + ": ";
        span.appendChild(b);

        span.className = "item";
        if (elem[key]) {
          span.innerHTML += elem[key];
        } else {
          var span1 = document.createElement("span");
          span1.className = "undefined";
          span1.innerHTML = "N/A";
          span.appendChild(span1)
        }
        item.appendChild(span);

        var br = document.createElement("br");
        item.appendChild(br);
      }
    })
    var button = document.createElement("button");
    button.innerHTML = "Delete";
    button.id = elem["_id"];
    button.addEventListener("click", function (e) {
      deleteData(e.target.id);
    }, false);
    item.appendChild(button);
    document.getElementById("dataContainer").appendChild(item);
  })

}
function deleteData(id) {

  var r = confirm("Are you sure you want to delete the item with the following ID? " + id);
  if (r == true) {

  } else {
    return;
  }

  var tmp = {
    "id": id
  }

  $.ajax({
    type: 'POST',
    url: "https://cse120-2021-api-ed.herokuapp.com/data/delete",
    data: tmp,
    cache: false,
    dataType: 'json',
    success: function (data) {
      console.log("success");
      document.getElementById("div" + id).style.display = "none";
    },
    error: function (xhr) {
      console.error("Error in post", xhr);
    },
    complete: function () {
      console.log("Complete");
    }
  });
}